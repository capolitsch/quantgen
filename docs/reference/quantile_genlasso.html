<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Quantile generalized lasso — quantile_genlasso • quantgen</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Quantile generalized lasso — quantile_genlasso"><meta property="og:description" content="Compute quantile generalized lasso solutions."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">quantgen</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/quantgen.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/cross_validation.html">1. Cross-validation</a>
    </li>
    <li>
      <a href="../articles/noncrossing_constraints.html">2. Noncrossing constraints</a>
    </li>
    <li>
      <a href="../articles/quantile_extrapolation.html">3. Quantile extrapolation</a>
    </li>
    <li>
      <a href="../articles/quantile_stacking.html">4. Quantile stacking</a>
    </li>
    <li>
      <a href="../articles/mathematical_details.html">5. Mathematical details</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ryantibs/quantgen/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Quantile generalized lasso</h1>
    <small class="dont-index">Source: <a href="https://github.com/ryantibs/quantgen/blob/HEAD/R/quantile_genlasso.R" class="external-link"><code>R/quantile_genlasso.R</code></a></small>
    <div class="hidden name"><code>quantile_genlasso.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute quantile generalized lasso solutions.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">quantile_genlasso</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">d</span>,</span>
<span>  <span class="va">tau</span>,</span>
<span>  <span class="va">lambda</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  intercept <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lb <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>  ub <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  noncross <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  x0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lp_solver <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glpk"</span>, <span class="st">"gurobi"</span><span class="op">)</span>,</span>
<span>  time_limit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  warm_starts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  transform <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  inv_trans <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  jitter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>Matrix of predictors. If sparse, then passing it an appropriate
sparse <code>Matrix</code> class can greatly help optimization.</p></dd>


<dt>y</dt>
<dd><p>Vector of responses.</p></dd>


<dt>d</dt>
<dd><p>Matrix defining the generalized lasso penalty; see details. If
sparse, then passing it an appropriate sparse <code>Matrix</code> class can
greatly help optimization. A convenience function <code>get_diff_mat</code> for
constructing trend filtering penalties is provided.</p></dd>


<dt>tau, lambda</dt>
<dd><p>Vectors of quantile levels and tuning parameter values. If
these are not of the same length, the shorter of the two is recycled so
that they become the same length. Then, for each <code>i</code>, we solve a
separate quantile generalized lasso problem at quantile level <code>tau[i]</code>
and tuning parameter value <code>lambda[i]</code>. The most common use cases are:
specifying one tau value and a sequence of lambda values; or specifying a
sequence of tau values and one lambda value.</p></dd>


<dt>weights</dt>
<dd><p>Vector of observation weights (to be used in the loss
function). Default is NULL, which is interpreted as a weight of 1 for each
observation.</p></dd>


<dt>intercept</dt>
<dd><p>Should an intercept be included in the regression model?
Default is TRUE.</p></dd>


<dt>standardize</dt>
<dd><p>Should the predictors be standardized (to have unit
variance) before fitting? Default is TRUE.</p></dd>


<dt>lb, ub</dt>
<dd><p>Lower and upper bounds, respectively, to place as constraints on
the coefficients in the optimization problem. These can be constants (to
place the same bound on each coefficient) or vectors of length equal to the
number of predictors (to place a potentially different bound on each
coefficient). Default is code-Inf and <code>Inf</code> for <code>lb</code> and
<code>ub</code>, respectively, which effectively means no constraints are used.
Two important notes: when <code>intercept</code> is TRUE, the constraints are
*not* placed on the intercept; and when <code>standardize</code> is TRUE, the
constraints are placed on the *standardized scale* (they are used in the 
optimization problem whose predictors have been standardized).</p></dd>


<dt>noncross</dt>
<dd><p>Should noncrossing constraints be applied? These force the
estimated quantiles to be properly ordered across all quantile levels being
considered. The default is FALSE. If TRUE, then noncrossing constraints are
applied to the estimated quantiles at all points specified by the next
argument <code>x0</code>. Note: this option only makes sense if the values in the
<code>tau</code> vector are distinct, and sorted in increasing order.</p></dd>


<dt>x0</dt>
<dd><p>Matrix of points used to define the noncrossing
constraints. Default is NULL, which means that we consider noncrossing
constraints at the training points <code>x</code>.</p></dd>


<dt>lp_solver</dt>
<dd><p>One of "glpk" or "gurobi", indicating which LP solver to
use. If possible, "gurobi" should be used because it is much faster and
more stable; default is "glpk"; however, because it is open-source.</p></dd>


<dt>time_limit</dt>
<dd><p>This sets the maximum amount of time (in seconds) to allow
Gurobi or GLPK to solve any single quantile generalized lasso problem (for
a single tau and lambda value). Default is NULL, which means unlimited
time.</p></dd>


<dt>warm_starts</dt>
<dd><p>Should warm starts be used in the LP solver (from one LP
solve to the next)? Only supported for Gurobi.</p></dd>


<dt>params</dt>
<dd><p>List of control parameters to pass to Gurobi or GLPK. Default
is <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> which means no additional parameters are passed. For
example: with Gurobi, we can use <code>list(Threads=4)</code> to specify that
Gurobi should use 4 threads when available. (Note that if a time limit is
specified through this <code>params</code> list, then its value will be overriden
by the last argument <code>time_limit</code>, assuming the latter is not NULL.)</p></dd>


<dt>transform, inv_trans</dt>
<dd><p>The first is a function to transform y before
solving the quantile generalized lasso; the second is the corresponding
inverse transform. For example: for count data, we might want to model
log(1+y) (which would be the transform, and the inverse transform would be
exp(x)-1). Both <code>transform</code> and <code>inv_trans</code> should be
vectorized. Convenience functions <code>log_pad</code> and <code>exp_pad</code> are
provided (these are inverses), as well as <code>logit_pad</code> and
<code>sigmd_pad</code> (these are inverses).</p></dd>


<dt>jitter</dt>
<dd><p>Function for applying random jitter to y, which might help
optimization. For example: for count data, there can be lots of ties (with
or without transformation of y), which can make optimization more
difficult. The function <code>jitter</code> should take an integer n and return n
random draws. A convenience function <code>unif_jitter</code> is provided.</p></dd>


<dt>verbose</dt>
<dd><p>Should progress be printed out to the console? Default is
FALSE.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list with the following components:</p>
<dl><dt>beta</dt>
<dd><p>Matrix of generalized lasso coefficients, of dimension =
  (number of features + 1) x (number of quantile levels) assuming
  <code>intercept=TRUE</code>, else (number of features) x (number of quantile
  levels). Note</p></dd>
</dl><p>these coefficients will always be on the appropriate scale;
  they are always on the scale of original features, even if
  <code>standardize=TRUE</code></p>
<dl><dt>status</dt>
<dd><p>Vector of status flags returned by Gurobi's or GLPK's LP
  solver, of length = (number of quantile levels)</p></dd>

  <dt>tau,lambda</dt>
<dd><p>Vectors of tau and lambda values used</p></dd>

  <dt>weights,intercept,...,jitter</dt>
<dd><p>Values of these other arguments
  used in the function call</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function solves the quantile generalized lasso problem, for
  each pair of quantile level \(\tau\) and tuning parameter \(\lambda\):
  $$\mathop{\mathrm{minimize}}_{\beta_0,\beta} \;
  \sum_{i=1}^n w_i \psi_\tau(y_i-\beta_0-x_i^T\beta) + \lambda \|D\beta\|_1$$
  for a response vector \(y\) with components \(y_i\), predictor matrix
  \(X\) with rows \(x_i\), and penalty matrix \(D\). Here
  \(\psi_\tau(v) = \max\{\tau v, (\tau-1) v\}\) is the
  "pinball" or "tilted \(\ell_1\)" loss. When noncrossing constraints are
  applied, we instead solve one big joint optimization, over all quantile
  levels and tuning parameter values:
  $$\mathop{\mathrm{minimize}}_{\beta_{0k}, \beta_k, k=1,\ldots,r} \;
  \sum_{k=1}^r \bigg(\sum_{i=1}^n w_i \psi_{\tau_k}(y_i-\beta_{0k}-
  x_i^T\beta_k) + \lambda_k \|D\beta_k\|_1\bigg)$$
  $$\mathrm{subject \; to} \;\; \beta_{0k}+x^T\beta_k \leq
  \beta_{0,k+1}+x^T\beta_{k+1} \;\; k=1,\ldots,r-1, \; x \in \mathcal{X}$$
  where the quantile levels \(\tau_k, k=1,\ldots,r\) are assumed to be in
  increasing order, and \(\mathcal{X}\) is a collection of points over
  which to enforce the noncrossing constraints.</p>
<p>Either problem is readily converted into a linear program (LP), and solved
  using either Gurobi (which is free for academic use, and generally fast) or
  GLPK (which free for everyone, but slower).</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Ryan Tibshirani</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Ryan Tibshirani, Logan Brooks.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

