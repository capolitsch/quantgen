<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Quantile extrapolater — quantile_extrapolate • quantgen</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Quantile extrapolater — quantile_extrapolate"><meta property="og:description" content="Extrapolate a set of quantiles at new quantile levels: parametric in the
tails, nonparametric in the middle."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">quantgen</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/quantgen.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/cross_validation.html">1. Cross-validation</a>
    </li>
    <li>
      <a href="../articles/noncrossing_constraints.html">2. Noncrossing constraints</a>
    </li>
    <li>
      <a href="../articles/quantile_extrapolation.html">3. Quantile extrapolation</a>
    </li>
    <li>
      <a href="../articles/quantile_stacking.html">4. Quantile stacking</a>
    </li>
    <li>
      <a href="../articles/mathematical_details.html">5. Mathematical details</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ryantibs/quantgen/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Quantile extrapolater</h1>
    <small class="dont-index">Source: <a href="https://github.com/ryantibs/quantgen/blob/HEAD/R/quantile_extrapolate.R" class="external-link"><code>R/quantile_extrapolate.R</code></a></small>
    <div class="hidden name"><code>quantile_extrapolate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Extrapolate a set of quantiles at new quantile levels: parametric in the
tails, nonparametric in the middle.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">quantile_extrapolate</span><span class="op">(</span></span>
<span>  <span class="va">tau</span>,</span>
<span>  <span class="va">qvals</span>,</span>
<span>  tau_out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.025</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>, <span class="fl">0.975</span>, <span class="fl">0.99</span><span class="op">)</span>,</span>
<span>  sort <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  iso <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nonneg <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  round <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  qfun_left <span class="op">=</span> <span class="va">qnorm</span>,</span>
<span>  qfun_right <span class="op">=</span> <span class="va">qnorm</span>,</span>
<span>  n_tau_left <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  n_tau_right <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  middle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cubic"</span>, <span class="st">"linear"</span><span class="op">)</span>,</span>
<span>  param0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  param1 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  grid_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>tau</dt>
<dd><p>Vector of quantile levels. Assumed to be distinct, and sorted in 
increasing order.</p></dd>


<dt>qvals</dt>
<dd><p>Vector or matrix quantiles; if a matrix, each row is a separate 
set of quantiles, at the same (common) quantile levels, given by
<code>tau</code>.</p></dd>


<dt>tau_out</dt>
<dd><p>Vector of quantile levels at which to perform
extrapolation. Default is a sequence of 23 quantile levels from 0.01 to
0.99.</p></dd>


<dt>sort</dt>
<dd><p>Should the returned quantile estimates be sorted? Default is
TRUE.</p></dd>


<dt>iso</dt>
<dd><p>Should the returned quantile estimates be passed through isotonic
regression? Default is FALSE; if TRUE, takes priority over <code>sort</code>.</p></dd>


<dt>nonneg</dt>
<dd><p>Should the returned quantile estimates be truncated at 0?
Natural for count data. Default is FALSE.</p></dd>


<dt>round</dt>
<dd><p>Should the returned quantile estimates be rounded? Natural for
count data. Default is FALSE.</p></dd>


<dt>qfun_left, qfun_right</dt>
<dd><p>Quantile functions on which to base extrapolation
in the left and right tails, respectively; each must be a function whose
first two arguments are a quantile level and a distribution parameter (such
as a mean parameter); these are assumed to be vectorized in the first
argument when the second argument is fixed, and also vectorized in the
second argument when the first argument is fixed. Default is
<code>qnorm</code>. See details for further explanation.</p></dd>


<dt>n_tau_left, n_tau_right</dt>
<dd><p>Integers between 1 and the length of
<code>tau</code>, indicating how many elements quantile levels from the left and
right ends, respectively, to use in defining the tails. For example, if
<code>n_tau_left=1</code>, the default, then only the leftmost quantile is used
for the left tail extrapolation; if <code>n_tau_left=2</code>, then the two
leftmost quantiles are used, etc; and similarly for <code>n_tau_right</code>. See
details for further explanation.</p></dd>


<dt>middle</dt>
<dd><p>One of "cubic" or "linear", indicating the interpolation method
to use in the middle (outside of the tails, as determined by
<code>n_tau_left</code> and <code>n_tau_right</code>). If "cubic", the default, then a
monotone cubic spline interpolant is fit to the given quantiles, and used
to estimate quantiles in the middle. If "linear", then linear interpolation
is used to estimate quantiles in the middle.</p></dd>


<dt>param0, param1, grid_size, tol, max_iter</dt>
<dd><p>Arguments for the algorithm used
for parameter-fitting for tail extrapolation. See details.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A matrix of dimension (number of rows in <code>qvals</code>) x (length of</p>
<p></p>
<p><code>tau_out</code>), where each row is the extrapolation of the set of
  quantiles in the corresponding row of <code>qvals</code>, at the quantile levels 
  specified in <code>tau_out</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function interpolates/extrapolates an initial sparser set of
  quantiles, say \(q_1,\ldots,q_m\) at the levels \(\tau_1 &lt; \ldots &lt;
  \tau_m\) into a denser set of quantiles, say \(q_1^*,\ldots,q^*_n\) at the
  levels \(\tau^*_1 &lt; \ldots &lt; \tau^*_n\).  At a high-level, the strategy
  is to nonparametrically interpolate the quantiles whose levels fall in the 
  interval \([\tau_1, \tau_m]\), and parametrically extrapolate the
  quantiles whose levels fall in \([0, \tau_1)\) or \((\tau_m, 1]\). Let
  us call these the "middle" and "tail" strategies, respectively.</p>
<p>To give more details on the middle strategy: a monotone spline
  interpolant---either a cubic spline (if <code>middle="cubic"</code>) or linear
  spline interpolant (if <code>middle="linear"</code>)---is fit to the points
  $$(\tau_i,q_i), \; i=1,\ldots,m.$$
  Denoting \(f\) by this interpolant, we then set
  $$q^*_i = f(\tau^*_i), \;\; \tau^*_i \in [\tau_1, \tau_m].$$</p>
<p>To give more details on the tail strategy: in each tail, left and right,
  the user specifies a tail function \(q(\tau; \theta)\) which depends on a
  parameter \(\theta\). This is done via the functions <code>qfun_left</code> 
  and <code>qfun_right</code>; the default is <code>qnorm</code> for both, in which case
  \(\theta\) represents the mean of the normal distribution (and the
  standard deviation is fixed at 1, as per the default in
  <code>qnorm</code>). Given this tail function, we then find the parameter value 
  \(\hat\theta\) that best matches the given quantile, and use this for 
  extrapolation. That is, for the left tail, we first fit \(\hat\theta\)
  such that  
  $$q(\tau_1; \hat\theta) \approx q_1$$
  and we then set
  $$q^*_i = q(\tau^*_i; \hat\theta), \;\; \tau^*_i &lt; \tau_1.$$
  The right tail is similar.</p>
<p>The fitting algorithm used for determining \(\hat\theta\) in each tail is
  a kind of iterative grid search that proceeds in "rounds". The arguments
  <code>param0,param1</code> give the left and right endpoints of the initial
  interval used in the first round of the search---this interval typically
  contracts as the rounds proceed, but can also expand as needed; the
  argument <code>grid_size</code> is the number of grid points to consider in each
  round; the argument <code>tol</code> is the error tolerance for stopping; and the
  argument <code>max_iter</code> is the maximum number of rounds to consider.  This
  fitting algorithm is robust to the case when the optimal parameter value
  that matches the given quantile, as per the above display, is not unqiue;
  in this case we take the mean of the range of optimal parameter values.</p>  
<p>Finally, when the arguments <code>n_tau_left</code> and <code>n_tau_right</code> are
  changed from their defaults, then this changes the definition of the
  "middle" and the "tail" ranges, but otherwise the analogous strategies are
  employed. In fact, the middle strategy is unchanged, just applied to a
  different range. The tail strategy is similar, but now in each tail, left
  and right, we fit a separate parameter value \(\hat\theta\) for each
  given quantile level in the tail range (for example, for each of the two
  leftmost quantile levels if <code>ntau_left=2</code>), and then take the mean of
  these parameters as a single parameter value on which to base tail
  extrapolation.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Ryan Tibshirani, Logan Brooks.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

