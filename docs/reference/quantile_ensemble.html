<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Quantile ensemble — quantile_ensemble • quantgen</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Quantile ensemble — quantile_ensemble" />
<meta property="og:description" content="Fit ensemble weights, given a set of quantile predictions." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">quantgen</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/quantgen.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/cross_validation.html">1. Cross-validation</a>
    </li>
    <li>
      <a href="../articles/noncrossing_constraints.html">2. Noncrossing constraints</a>
    </li>
    <li>
      <a href="../articles/quantile_extrapolation.html">3. Quantile extrapolation</a>
    </li>
    <li>
      <a href="../articles/quantile_stacking.html">4. Quantile stacking</a>
    </li>
    <li>
      <a href="../articles/mathematical_details.html">5. Mathematical details</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ryantibs/quantgen/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Quantile ensemble</h1>
    <small class="dont-index">Source: <a href='https://github.com/ryantibs/quantgen/blob/master/R/quantile_ensemble.R'><code>R/quantile_ensemble.R</code></a></small>
    <div class="hidden name"><code>quantile_ensemble.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit ensemble weights, given a set of quantile predictions.</p>
    </div>

    <pre class="usage"><span class='fu'>quantile_ensemble</span>(
  <span class='no'>qarr</span>,
  <span class='no'>y</span>,
  <span class='no'>tau</span>,
  <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>tau_groups</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>tau</span>)),
  <span class='kw'>intercept</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>nonneg</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>unit_sum</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>noncross</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>q0</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>lp_solver</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"glpk"</span>, <span class='st'>"gurobi"</span>),
  <span class='kw'>time_limit</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>params</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>qarr</th>
      <td><p>Array of predicted quantiles, of dimension (number of prediction
points) x (number or ensemble components) x (number of quantile levels).</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>Vector of responses (whose quantiles are being predicted by
<code>qarr</code>).</p></td>
    </tr>
    <tr>
      <th>tau</th>
      <td><p>Vector of quantile levels at which predictions are made. Assumed
to be distinct, and sorted in increasing order.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>Vector of observation weights (to be used in the loss
function). Default is NULL, which is interpreted as a weight of 1 for each
observation.</p></td>
    </tr>
    <tr>
      <th>tau_groups</th>
      <td><p>Vector of group labels, having the same length as
<code>tau</code>. Common labels indicate that the ensemble weights for the
corresponding quantile levels should be tied together. Default is
<code><a href='https://rdrr.io/r/base/rep.html'>rep(1,length(tau))</a></code>, which means that a common set of ensemble
weights should be used across all levels. See details.</p></td>
    </tr>
    <tr>
      <th>intercept</th>
      <td><p>Should an intercept be included in the ensemble model?
Default is FALSE.</p></td>
    </tr>
    <tr>
      <th>nonneg</th>
      <td><p>Should the ensemble weights be constrained to be nonnegative?
Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>unit_sum</th>
      <td><p>Should the ensemble weights be constrained to sum to 1?
Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>noncross</th>
      <td><p>Should noncrossing constraints be enforced? Default is
TRUE. Note: this option only matters when there is more than group of
ensemble weights, as determined by <code>tau_groups</code>. See details.</p></td>
    </tr>
    <tr>
      <th>q0</th>
      <td><p>Array of points used to define the noncrossing
constraints. Must have dimension (number of points) x (number of ensemble
components) x (number of quantile levels). Default is NULL, which means
that we consider noncrossing constraints at the training points
<code>qarr</code>.</p></td>
    </tr>
    <tr>
      <th>lp_solver</th>
      <td><p>One of "glpk" or "gurobi", indicating which LP solver to
use. If possible, "gurobi" should be used because it is much faster and
more stable; default is "glpk"; however, because it is open-source.</p></td>
    </tr>
    <tr>
      <th>time_limit</th>
      <td><p>This sets the maximum amount of time (in seconds) to allow
Gurobi or GLPK to solve any single quantile generalized lasso problem (for
a single tau and lambda value). Default is NULL, which means unlimited
time.</p></td>
    </tr>
    <tr>
      <th>params</th>
      <td><p>List of control parameters to pass to Gurobi or GLPK. Default
is <code><a href='https://rdrr.io/r/base/list.html'>list()</a></code> which means no additional parameters are passed. For
example: with Gurobi, we can use <code><a href='https://rdrr.io/r/base/list.html'>list(Threads=4)</a></code> to specify that
Gurobi should use 4 threads when available. (Note that if a time limit is
specified through this <code>params</code> list, then its value will be overriden
by the last argument <code>time_limit</code>, assuming the latter is not NULL.)</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Should progress be printed out to the console? Default is
FALSE.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with the following components:</p>
<dt>alpha</dt><dd><p>Vector or matrix of ensemble weights. If <code>tau_groups</code> has
  only one unique label, then this is a vector of length = (number of
  ensemble components); otherwise, it is a matrix, of dimension (number of 
  ensemble components) x (number of quantile levels)</p></dd>
  <dt>tau</dt><dd><p>Vector of quantile levels used</p></dd>
  <dt>weights,tau_groups,...,params</dt><dd><p>Values of these other arguments 
  used in the function call</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function solves the following quantile ensemble optimization
  problem, over quantile levels \(\tau_k, k=1,\ldots,r\):
  $$\mathop{\mathrm{minimize}}_{\alpha_j, j=1,\ldots,p} \; \sum_{k=1}^r
  \sum_{i=1}^n w_i \psi_{\tau_k} \bigg(y_i - \sum_{j=1}^p \alpha_j q_{ijk}
  \bigg)$$ $$\mathrm{subject \; to} \;\; \sum_{j=1}^p \alpha_j = 1, \;
  \alpha_j \geq 0, \; j=1,\ldots,p$$
  for a response vector \(y\) and quantile array \(q\), where
  \(q_{ijk}\) is an estimate of the quantile of \(y_i\) at the level
  \(\tau_k\), from ensemble component member \(j\). Here
  \(\psi_\tau(v) = \max\{\tau v, (\tau-1) v\}\) is the "pinball" or "tilted
  \(\ell_1\)" loss. A more advanced version allows us to estimate a
  separate ensemble weight \(\alpha_{jk}\) per component method \(j\),
  per quantile level \(k\):
  $$\mathop{\mathrm{minimize}}{\alpha_{jk}, j=1,\ldots,p, k=1,\ldots,r}
  \; \sum_{k=1}^r \sum_{i=1}^n w_i \psi_{\tau_k} \bigg(y_i - \sum_{j=1}^p
  \alpha_{jk} q_{ijk} \bigg)$$ $$\mathrm{subject \; to} \;\;
  \sum_{j=1}^p \alpha_{jk} = 1, \; k=1,\ldots,r, \;
  \alpha_{jk} \geq 0, \; j=1,\ldots,p, \; k=1,\ldots,r$$
  As a form of regularization, we can additionally incorporate noncrossing
  constraints into the above optimization, which take the form:
  $$\alpha_{\bullet,k}^T q \leq \alpha_{\bullet,k+1}^T q, \;
  k=1,\ldots,r-1, \; q \in \mathcal{Q}$$
  where the quantile levels \(\tau_k, k=1,\ldots,r\) are assumed to be in
  increasing order, and \(\mathcal{Q}\) is a collection of points over
  which to enforce the noncrossing constraints. Finally, somewhere in between
  these two extremes is to allow one ensemble weight per component member
  \(j\), per quantile group \(g\). This can be interpreted as a set of
  further constraints which enforce equality between \(\alpha_{jk}\) and
  \(\alpha_{j\ell}\), for all \(k,\ell\) that are in the same group
  \(g\).</p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Ryan Tibshirani, Logan Brooks.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


